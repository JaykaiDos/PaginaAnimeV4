<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de AdministraciÃ³n - Anime Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/admin.css">
</head>
<body>

  <!-- HEADER -->
  <header class="admin-header">
    <div class="header-content">
      <h1 class="admin-title">ğŸ›ï¸ Panel de AdministraciÃ³n</h1>
      <div class="header-actions">
        <span class="user-info" id="userEmail">Cargando...</span>
        <button class="btn-logout" onclick="window.authSystem.logoutAdmin()">
          ğŸšª Cerrar SesiÃ³n
        </button>
      </div>
    </div>
  </header>

  <!-- NAVIGATION TABS -->
  <nav class="admin-nav">
    <button class="nav-tab active" data-tab="seasons">
      ğŸ—“ï¸ Temporadas
    </button>
    <button class="nav-tab" data-tab="animes">
      ğŸ“º Animes
    </button>
    <button class="nav-tab" data-tab="episodes">
      ğŸ¬ Episodios
    </button>
    <button class="nav-tab" data-tab="characters">
      ğŸ­ Personajes
    </button>
  </nav>

  <div class="admin-container">

    <!-- TAB 1: TEMPORADAS -->
    <section class="tab-content active" id="seasons-tab">
      <div class="section-header">
        <h2 class="section-title">ğŸ—“ï¸ GestiÃ³n de Temporadas</h2>
        <button class="btn-primary" onclick="openSeasonModal()">
          â• Nueva Temporada
        </button>
      </div>

      <div class="seasons-grid" id="seasonsGrid">
        <div class="loading">
          <div class="spinner"></div>
          <p>Cargando temporadas...</p>
        </div>
      </div>
    </section>

    <!-- TAB 2: ANIMES -->
    <section class="tab-content" id="animes-tab">
      <div class="section-header">
        <h2 class="section-title">ğŸ“º GestiÃ³n de Animes</h2>
        <button class="btn-primary" onclick="openAnimeModal()">
          â• Nuevo Anime
        </button>
      </div>

      <div class="filter-section">
        <label for="seasonFilter">Filtrar por temporada:</label>
        <select id="seasonFilter" onchange="filterAnimesBySeason()">
          <option value="all">Todas las temporadas</option>
        </select>
      </div>

      <div class="animes-list" id="animesList">
        <div class="loading">
          <div class="spinner"></div>
          <p>Cargando animes...</p>
        </div>
      </div>
    </section>

    <!-- TAB 3: EPISODIOS -->
    <section class="tab-content" id="episodes-tab">
      <div class="section-header">
        <h2 class="section-title">ğŸ¬ GestiÃ³n de Episodios</h2>
      </div>

      <div class="filter-section">
        <label for="animeSelector">Selecciona un anime:</label>
        <select id="animeSelector" onchange="loadEpisodesByAnime()">
          <option value="">-- Selecciona un anime --</option>
        </select>
        <button class="btn-primary" onclick="openEpisodeModal()" id="addEpisodeBtn" disabled>
          â• Nuevo Episodio
        </button>
      </div>

      <div class="episodes-list" id="episodesList">
        <p class="empty-state">Selecciona un anime para ver sus episodios</p>
      </div>
    </section>

    <!-- TAB 4: PERSONAJES -->
    <section class="tab-content" id="characters-tab">
      <div class="section-header">
        <h2 class="section-title">ğŸ­ GestiÃ³n de Personajes</h2>
      </div>

      <div class="info-box">
        <p>â„¹ï¸ Los personajes se importan automÃ¡ticamente desde MyAnimeList.</p>
        <p>Para importar personajes, ve a la pestaÃ±a <strong>Animes</strong> y presiona el botÃ³n <strong>"ğŸ­ Importar Personajes"</strong>.</p>
      </div>

      <div class="filter-section">
        <label for="characterAnimeFilter">Filtrar por anime:</label>
        <select id="characterAnimeFilter" onchange="loadCharacters()">
          <option value="all">Todos los animes</option>
        </select>
      </div>

      <div class="characters-list" id="charactersList">
        <div class="loading">
          <div class="spinner"></div>
          <p>Cargando personajes...</p>
        </div>
      </div>
    </section>

  </div>

  <!-- MODAL: TEMPORADA -->
  <div class="modal" id="seasonModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="seasonModalTitle">Nueva Temporada</h3>
        <button class="btn-close" onclick="closeSeasonModal()">âœ•</button>
      </div>
      
      <form id="seasonForm">
        <div class="form-group">
          <label for="seasonName">Nombre de la Temporada *</label>
          <input type="text" id="seasonName" placeholder="Ej: OtoÃ±o 2025" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="seasonEmoji">Emoji</label>
            <input type="text" id="seasonEmoji" placeholder="ğŸ‚" maxlength="2">
          </div>
          <div class="form-group">
            <label for="seasonOrder">Orden</label>
            <input type="number" id="seasonOrder" value="1" min="1">
          </div>
        </div>

        <div class="form-group">
          <label for="seasonPeriod">PerÃ­odo *</label>
          <input type="text" id="seasonPeriod" placeholder="Octubre - Diciembre" required>
        </div>

        <div class="form-group">
          <label for="seasonStatus">Estado *</label>
          <select id="seasonStatus" required>
            <option value="active">Activo</option>
            <option value="completed">Finalizado</option>
          </select>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeSeasonModal()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar Temporada</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: ANIME -->
  <div class="modal" id="animeModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 class="modal-title" id="animeModalTitle">Nuevo Anime</h3>
        <button class="btn-close" onclick="closeAnimeModal()">âœ•</button>
      </div>
      
      <form id="animeForm">
        <div class="form-group">
          <label for="animeSeasonId">Vincular a Temporada *</label>
          <select id="animeSeasonId" required>
            <option value="">Cargando temporadas...</option>
          </select>
          <small>Esto determinarÃ¡ en quÃ© pÃ¡gina (OtoÃ±o, Invierno, etc.) aparecerÃ¡ el anime.</small>
        </div>

        <div class="form-group">
          <label for="animeTitle">TÃ­tulo del Anime *</label>
          <input type="text" id="animeTitle" placeholder="Ej: Solo Leveling" required>
        </div>

        <div class="form-group">
          <label for="animeMalId">MyAnimeList ID (opcional)</label>
          <input type="number" id="animeMalId" placeholder="Ej: 52034">
          <small>Si no lo conoces, dÃ©jalo vacÃ­o. PodrÃ¡s vincularlo despuÃ©s para importar personajes.</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="animeCategory">CategorÃ­a *</label>
            <select id="animeCategory" required>
              <option value="continuation">â­ ContinuaciÃ³n</option>
              <option value="new">ğŸ†• Nuevo Estreno</option>
            </select>
          </div>
          <div class="form-group">
            <label for="animeYear">AÃ±o</label>
            <input type="number" id="animeYear" value="2025" min="2000" max="2030">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="animeStatus">Estado</label>
            <select id="animeStatus">
              <option value="airing">En emisiÃ³n</option>
              <option value="completed">Finalizado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="animeOrder">Orden</label>
            <input type="number" id="animeOrder" value="1" min="1">
          </div>
        </div>

        <div class="form-group">
          <label for="animeCardImage">URL Imagen Card (para temporada) *</label>
          <input type="url" id="animeCardImage" placeholder="https://..." required>
        </div>

        <div class="form-group">
          <label for="animePoster">URL PÃ³ster (para detalles) *</label>
          <input type="url" id="animePoster" placeholder="https://..." required>
        </div>

        <div class="form-group">
          <label for="animeSynopsis">Sinopsis *</label>
          <textarea id="animeSynopsis" rows="4" placeholder="DescripciÃ³n del anime..." required></textarea>
        </div>

        <div class="form-group">
          <label for="animeTrailers">Trailers (URLs separadas por comas)</label>
          <textarea id="animeTrailers" rows="2" placeholder="https://youtube.com/embed/..., https://youtube.com/embed/..."></textarea>
          <small>Formato: URLs de YouTube embed separadas por comas</small>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             SECCIÃ“N: OVERRIDE DE HORARIO DE EMISIÃ“N
             Visible solo al editar. Permite corregir el
             dÃ­a/hora si MAL tiene datos desactualizados.
             broadcastOverride tiene prioridad sobre broadcast.
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="broadcast-override-section" id="broadcastOverrideSection" style="display:none;">

          <div class="broadcast-override-header">
            <h4 class="broadcast-override-title">ğŸ“… Horario de EmisiÃ³n</h4>
            <span class="broadcast-override-badge" id="broadcastSourceBadge"></span>
          </div>

          <!-- Muestra el valor actual de MAL como referencia -->
          <div class="broadcast-mal-info" id="broadcastMalInfo"></div>

          <div class="form-row">
            <div class="form-group">
              <label for="broadcastOverrideDay">DÃ­a de emisiÃ³n (override)</label>
              <select id="broadcastOverrideDay">
                <option value="">â€” Usar dato de MAL â€”</option>
                <option value="Mondays">Lunes</option>
                <option value="Tuesdays">Martes</option>
                <option value="Wednesdays">MiÃ©rcoles</option>
                <option value="Thursdays">Jueves</option>
                <option value="Fridays">Viernes</option>
                <option value="Saturdays">SÃ¡bado</option>
                <option value="Sundays">Domingo</option>
              </select>
              <small>Solo necesario si MAL tiene el dÃ­a incorrecto</small>
            </div>
            <div class="form-group">
              <label for="broadcastOverrideTime">Hora (en JST / Asia/Tokyo)</label>
              <input type="time" id="broadcastOverrideTime">
              <small>Hora de JapÃ³n â€” igual que el formato de MAL</small>
            </div>
          </div>

          <button
            type="button"
            class="btn-clear-override"
            id="clearBroadcastOverride"
            onclick="clearBroadcastOverride()"
          >
            ğŸ”„ Quitar override â€” volver a usar dato de MAL
          </button>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeAnimeModal()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar Anime</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: EPISODIO -->
  <div class="modal" id="episodeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Nuevo Episodio</h3>
        <button class="btn-close" onclick="closeEpisodeModal()">âœ•</button>
      </div>
      
      <form id="episodeForm">
        <div class="form-row">
          <div class="form-group">
            <label for="episodeNumber">NÃºmero de Episodio *</label>
            <input type="number" id="episodeNumber" min="1" required>
          </div>
          <div class="form-group">
            <label for="episodeDuration">DuraciÃ³n</label>
            <input type="text" id="episodeDuration" value="24 min">
          </div>
        </div>

        <div class="form-group">
          <label for="episodeTitle">TÃ­tulo del Episodio *</label>
          <input type="text" id="episodeTitle" placeholder="Episodio 1" required>
        </div>

        <div class="form-group">
          <label for="episodeVideoUrl">URL del Video *</label>
          <input type="url" id="episodeVideoUrl" placeholder="//ok.ru/videoembed/... o https://drive.google.com/..." required>
          <small>Soporta: Ok.ru, Google Drive, YouTube, etc.</small>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeEpisodeModal()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar Episodio</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: BUSCAR EN MYANIMELIST -->
  <div class="modal" id="malSearchModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 class="modal-title">ğŸ” Buscar en MyAnimeList</h3>
        <button class="btn-close" onclick="closeMalSearchModal()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="malSearchQuery">Buscar anime:</label>
          <div style="display: flex; gap: 1rem;">
            <input type="text" id="malSearchQuery" placeholder="Ej: Solo Leveling" style="flex: 1;">
            <button class="btn-primary" onclick="searchMal()">ğŸ” Buscar</button>
          </div>
        </div>

        <div id="malSearchResults" style="margin-top: 2rem;">
          <!-- Resultados aquÃ­ -->
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- Scripts -->
  <script src="../js/firebase-config.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/jikan-service.js"></script>
  <script src="../js/firebase-service.js"></script>
  <script src="../js/admin-panel.js"></script>

</body>
</html>